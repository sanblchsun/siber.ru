'use strict';
$(document).ready(function($) {

	// "подписаться на новости"
	// =========================
	if ($('#form-news').length > 0){
		$('#form-news').doubleValidate({
			validateSuccess: function(data){
				$('#form-news .form__wrapper').slideUp();
				$('#form-news .form__success').slideDown();
			}
		});

		var button 	= $('.button-submite');

		$('.form__input--email').on('input', function(){
			var _self 		= $(this);
			var dataInput 	= _self.val();
			var succesSub	= $('.success-text');
			var parsjn;

			button .prop("disabled", true);

			$.ajax({
				url: "/local/api/news-current-subcriby/",
				data: {email: dataInput},
				type: "POST"
			}).done(function(result) {
				parsjn = JSON.parse(result);
				if(parsjn != null){
					console.log(result);
					console.log(parsjn);
					console.log(parsjn['EMAIL']);
					if(parsjn['EMAIL'] == dataInput){
						succesSub.text('Вы отписались');
						button.text('Отписаться');
					}else{
						succesSub.text('Спасибо за подписку');
						button.text('Подписаться');
					}
				}
				button.prop("disabled", false);
			}).fail(function(result) {
				button.prop("disabled", false);
			});
		});
	}

});