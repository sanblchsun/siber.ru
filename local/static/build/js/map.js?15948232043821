'use strict';

var googleMapApp = {

	init: function(wrapId){

		// Создаём карту
		var map = new google.maps.Map(document.getElementById(wrapId), {
			zoom: 16,
			styles: this.styleArray,
			center: new google.maps.LatLng(0, 0),
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			scrollwheel: false
		});

		// Маркеры
		var $coordInputs = $('.map-google__coord');
		var markers = [];
		$coordInputs.each(function(index, el) {
			markers.push($(el).val().split(','));
		});
		var image  = new google.maps.MarkerImage(
			this.ballunImage,
			new google.maps.Size(70, 80),
			new google.maps.Point(0,0)
		);
		$coordInputs.on('change', function(event) {
			$coordInputs.unbind('change');
			googleMapApp.init(wrapId);
		});


		// Область показа маркеров
		var markersBounds = new google.maps.LatLngBounds();

		for (var i = 0; i < markers.length; i++) {
			var markerPosition = new google.maps.LatLng(markers[i][0], markers[i][1]);

			// Добавляем координаты маркера в область
			markersBounds.extend(markerPosition);

			// Создаём маркер
			var marker = new google.maps.Marker({
				position: markerPosition,
				map: map,
				icon: image,
			});
		}

		if (markers.length > 1) {
			// Центрируем и масштабируем карту
			map.setCenter(markersBounds.getCenter(), map.fitBounds(markersBounds));
		} else {
			map.setCenter(new google.maps.LatLng(markers[0][0], markers[0][1]));
		}
	},

	ballunImage: '/local/static/build/img/map.png',

	styleArray: [
		{
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#f5f5f5"
				}
			]
		},
		{
			"elementType": "labels.icon",
			"stylers": [
				{
					"visibility": "off"
				}
			]
		},
		{
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#616161"
				}
			]
		},
		{
			"elementType": "labels.text.stroke",
			"stylers": [
				{
					"color": "#f5f5f5"
				}
			]
		},
		{
			"featureType": "administrative.land_parcel",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#bdbdbd"
				}
			]
		},
		{
			"featureType": "poi",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#eeeeee"
				}
			]
		},
		{
			"featureType": "poi",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#757575"
				}
			]
		},
		{
			"featureType": "poi.park",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#e5e5e5"
				}
			]
		},
		{
			"featureType": "poi.park",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#9e9e9e"
				}
			]
		},
		{
			"featureType": "road",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#ffffff"
				}
			]
		},
		{
			"featureType": "road.arterial",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#757575"
				}
			]
		},
		{
			"featureType": "road.highway",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#dadada"
				}
			]
		},
		{
			"featureType": "road.highway",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#616161"
				}
			]
		},
		{
			"featureType": "road.local",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#9e9e9e"
				}
			]
		},
		{
			"featureType": "transit.line",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#e5e5e5"
				}
			]
		},
		{
			"featureType": "transit.station",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#eeeeee"
				}
			]
		},
		{
			"featureType": "water",
			"elementType": "geometry",
			"stylers": [
				{
					"color": "#c9c9c9"
				}
			]
		},
		{
			"featureType": "water",
			"elementType": "labels.text.fill",
			"stylers": [
				{
					"color": "#9e9e9e"
				}
			]
		}
	]
};